type: Group
instructions:
  - type: MakeDirectory
    directory: .git
  - type: MakeDirectory
    directory: build
  - type: ChangeDirectory
    directory: "{{.BuildDir}}/build"
  - type: MakeDirectory
    directory: host
  - type: MakeDirectory
    directory: target
  - type: SetBuildDirectory
    directory: "{{.SourceDir}}/build/host"
  - type: ChangeDirectory
    directory: "{{.BuildDir}}"
  - type: EnvironmentVariable
    variableName: COIN_CMAKE_ARGS
    variableValue: "-DBUILD_TESTING=OFF {{.SourceDir}}"
  - !include "{{qt/qtbase}}/call_host_cmake.yaml"
  - type: ExecuteCommand
    command: "{{.Env.ENV_PREFIX}} cmake --build . --parallel"
    maxTimeInSeconds: 6000
    maxTimeBetweenOutput: 1200
    userMessageOnFailure: >
      Failed to build sources. In the current state bug can be everywhere. Contact Liang first.
  - type: ExecuteCommand
    command: "{{.Env.ENV_PREFIX}} cmake --install ."
    maxTimeInSeconds: 6000
    maxTimeBetweenOutput: 1200
    userMessageOnFailure: >
      Failed to install package.
  - type: EnvironmentVariable
    variableName: DESTDIR
    variableValue: "{{.InstallRoot}}"
  - type: ExecuteCommand
    command: "{{.Env.ENV_PREFIX}} cmake --install ."
    maxTimeInSeconds: 6000
    maxTimeBetweenOutput: 1200
    userMessageOnFailure: >
      Failed to install package for archiving.
  - type: EnvironmentVariable
    variableName: DESTDIR
    variableValue: ""
  - type: SetBuildDirectory
    directory: "{{.SourceDir}}/build/target"
  - type: ChangeDirectory
    directory: "{{.BuildDir}}"
  - type: EnvironmentVariable
    variableName: COIN_CMAKE_ARGS
    variableValue: "-DBUILD_TESTING=OFF {{.SourceDir}}"
  - !include "{{qt/qtbase}}/call_target_cmake.yaml"
  - type: ExecuteCommand
    command: "{{.Env.ENV_PREFIX}} cmake --build . --parallel"
    maxTimeInSeconds: 6000
    maxTimeBetweenOutput: 1200
    userMessageOnFailure: >
      Failed to build sources. In the current state bug can be everywhere. Contact Liang first.
  - type: ExecuteCommand
    command: "{{.Env.ENV_PREFIX}} cmake --install ."
    maxTimeInSeconds: 6000
    maxTimeBetweenOutput: 1200
    userMessageOnFailure: >
      Failed to install package.
  - type: EnvironmentVariable
    variableName: DESTDIR
    variableValue: "{{.InstallRoot}}"
  - type: ExecuteCommand
    command: "{{.Env.ENV_PREFIX}} cmake --install ."
    maxTimeInSeconds: 6000
    maxTimeBetweenOutput: 1200
    userMessageOnFailure: >
      Failed to install package for archiving.
  - type: EnvironmentVariable
    variableName: DESTDIR
    variableValue: ""
  - type: UploadArtifact
    archiveDirectory: "{{.InstallRoot}}/{{.AgentWorkingDir}}"
    transferType: UploadModuleBuildArtifact
    maxTimeInSeconds: 1200
    maxTimeBetweenOutput: 1200
